<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script>

<%- include("../partials/user/header.ejs") %>

<style>
body, p, div, h1, h2, a, span, strong {
  font-family: 'Arial', sans-serif;
  color: #333;
  margin: 0;
  padding: 0;
  transition: color 0.3s ease, background-color 0.3s ease;
}

@import url("https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Montserrat:wght@300;400;600&display=swap");

* {
  box-sizing: border-box;
}

html, body {
  width: 100%;
  overflow-x: hidden;
}

/* ============================================
   LIGHT MODE - DEFAULT
   ============================================ */

body {
  background-color: #fff;
  color: #333;
  font-size: 16px;
}

.banner {
  width: 100%;
  height: 450px;
  overflow: hidden;
  position: relative;
  background: linear-gradient(135deg, #0a0a0a 0%, #000000 50%, #000000 100%);
}

.zodiac-banner {
  position: relative;
  width: 100%;
  height: 100%;
  transform: perspective(1200px) rotateX(-5deg);
  transform-style: preserve-3d;
}

.zodiac-container {
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
}

input[type="radio"][name="zodiac"] {
  display: none;
}

.zodiac-slide {
  position: absolute;
  left: 0;
  right: 0;
  top: 50%;
  transform: translateY(-50%) translateZ(-3000px);
  margin: auto;
  width: 100%;
  height: 400px;
  opacity: 0;
  transition: all 0.6s cubic-bezier(0.33, 0, 0, 1);
  pointer-events: none;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1;
}

.zodiac-content {
  text-align: center;
  color: white;
  padding: 20px;
}

.zodiac-symbol {
  font-size: 80px;
  font-family: "Cinzel", serif;
  margin-bottom: 20px;
  text-shadow: 0 0 40px var(--zodiac-glow), 0 0 80px var(--zodiac-glow);
  animation: float 3s ease-in-out infinite;
  color: var(--zodiac-color);
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-20px); }
}

.zodiac-name {
  font-size: 56px;
  letter-spacing: 12px;
  text-transform: uppercase;
  font-family: "Cinzel", serif;
  font-weight: 700;
  margin-bottom: 15px;
  color: white;
  text-shadow: 0 0 20px var(--zodiac-glow);
}

.zodiac-element {
  font-size: 14px;
  letter-spacing: 5px;
  text-transform: uppercase;
  color: var(--zodiac-color);
  margin-bottom: 10px;
  font-weight: 300;
}

.zodiac-description {
  font-size: 18px;
  letter-spacing: 3px;
  line-height: 28px;
  opacity: 0.9;
  max-width: 500px;
  margin: 0 auto 15px;
  color: white;
}

.zodiac-dates {
  font-size: 12px;
  letter-spacing: 3px;
  color: var(--zodiac-color);
  opacity: 0.8;
}

.sparkle-container {
  position: absolute;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

.sparkle {
  position: absolute;
  width: 4px;
  height: 4px;
  background: white;
  border-radius: 50%;
  animation: sparkleFloat 4s ease-in-out infinite;
  opacity: 0;
}

.sparkle:nth-child(1) { left: 20%; top: 15%; animation-delay: 0s; }
.sparkle:nth-child(2) { left: 80%; top: 25%; animation-delay: 0.5s; }
.sparkle:nth-child(3) { left: 15%; top: 70%; animation-delay: 1s; }
.sparkle:nth-child(4) { left: 85%; top: 60%; animation-delay: 1.5s; }
.sparkle:nth-child(5) { left: 50%; top: 10%; animation-delay: 2s; }
.sparkle:nth-child(6) { left: 90%; top: 80%; animation-delay: 2.5s; }

@keyframes sparkleFloat {
  0%, 100% { opacity: 0; transform: translateY(0) scale(1); }
  50% { opacity: 1; transform: translateY(-20px) scale(1.5); }
}

.zodiac-menu {
  position: absolute;
  left: 40px;
  top: 50%;
  transform: translateY(-50%);
  z-index: 100;
}

.zodiac-menu label {
  display: block;
  color: white;
  margin-bottom: 20px;
  cursor: pointer;
  font-size: 11px;
  letter-spacing: 2px;
  text-transform: uppercase;
  opacity: 0.4;
  transition: all 0.3s;
  position: relative;
  padding-left: 25px;
}

.zodiac-menu label::before {
  content: '';
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 8px;
  height: 8px;
  border: 2px solid white;
  border-radius: 50%;
}

.zodiac-menu label:hover {
  opacity: 0.8;
}

input[type="radio"]:checked + .zodiac-slide {
  transform: translateY(-50%) translateZ(0px);
  opacity: 1;
  pointer-events: all;
}

#aries:checked ~ div:nth-of-type(1),
#taurus:checked ~ div:nth-of-type(2),
#gemini:checked ~ div:nth-of-type(3),
#cancer:checked ~ div:nth-of-type(4),
#leo:checked ~ div:nth-of-type(5),
#virgo:checked ~ div:nth-of-type(6),
#libra:checked ~ div:nth-of-type(7),
#scorpio:checked ~ div:nth-of-type(8),
#sagittarius:checked ~ div:nth-of-type(9),
#capricorn:checked ~ div:nth-of-type(10),
#aquarius:checked ~ div:nth-of-type(11),
#pisces:checked ~ div:nth-of-type(12) {
  transform: translateY(-50%) translateZ(0px) !important;
  opacity: 1 !important;
  pointer-events: all;
  z-index: 10 !important;
}

#aries:checked ~ .zodiac-menu label[for="aries"],
#taurus:checked ~ .zodiac-menu label[for="taurus"],
#gemini:checked ~ .zodiac-menu label[for="gemini"],
#cancer:checked ~ .zodiac-menu label[for="cancer"],
#leo:checked ~ .zodiac-menu label[for="leo"],
#virgo:checked ~ .zodiac-menu label[for="virgo"],
#libra:checked ~ .zodiac-menu label[for="libra"],
#scorpio:checked ~ .zodiac-menu label[for="scorpio"],
#sagittarius:checked ~ .zodiac-menu label[for="sagittarius"],
#capricorn:checked ~ .zodiac-menu label[for="capricorn"],
#aquarius:checked ~ .zodiac-menu label[for="aquarius"],
#pisces:checked ~ .zodiac-menu label[for="pisces"] {
  opacity: 1 !important;
}

#aries:checked ~ .zodiac-menu label[for="aries"]::before,
#taurus:checked ~ .zodiac-menu label[for="taurus"]::before,
#gemini:checked ~ .zodiac-menu label[for="gemini"]::before,
#cancer:checked ~ .zodiac-menu label[for="cancer"]::before,
#leo:checked ~ .zodiac-menu label[for="leo"]::before,
#virgo:checked ~ .zodiac-menu label[for="virgo"]::before,
#libra:checked ~ .zodiac-menu label[for="libra"]::before,
#scorpio:checked ~ .zodiac-menu label[for="scorpio"]::before,
#sagittarius:checked ~ .zodiac-menu label[for="sagittarius"]::before,
#capricorn:checked ~ .zodiac-menu label[for="capricorn"]::before,
#aquarius:checked ~ .zodiac-menu label[for="aquarius"]::before,
#pisces:checked ~ .zodiac-menu label[for="pisces"]::before {
  background: white;
}

.star-bg {
  position: absolute;
  width: 100%;
  height: 100%;
  z-index: 0;
}

.star {
  position: absolute;
  width: 2px;
  height: 2px;
  background: white;
  border-radius: 50%;
  animation: twinkle 3s ease-in-out infinite;
}

@keyframes twinkle {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 1; }
}

.banner-logo {
  position: absolute;
  top: 30px;
  left: 50%;
  transform: translateX(-50%);
  color: white;
  font-size: 16px;
  letter-spacing: 4px;
  text-transform: uppercase;
  z-index: 100;
  font-weight: 300;
  text-align: center;
  width: 90%;
}

.banner-logo span {
  display: block;
  font-size: 13px;
  color: #d4af37;
  margin-top: 5px;
  letter-spacing: 2px;
}

.section {
  padding: 40px 20px;
  text-align: center;
  background-color: #fff;
}

.section h2 {
  color: #ff0000;
  margin-bottom: 30px;
  font-size: 2rem;
  font-weight: bold;
}

.product-grid {
  display: flex;
  justify-content: center;
  gap: 30px;
  flex-wrap: wrap;
  max-width: 1400px;
  margin: 0 auto;
}

.discover-btn {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 100;
  padding: 15px 40px;
  background: linear-gradient(135deg, #d4af37, #f0d978);
  color: #0a0a0a;
  font-size: 14px;
  font-weight: 600;
  letter-spacing: 3px;
  text-transform: uppercase;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
  transition: all 0.3s ease;
  text-decoration: none;
  display: inline-block;
}

.discover-btn:hover {
  background: linear-gradient(135deg, #f0d978, #d4af37);
  transform: translateX(-50%) translateY(-3px);
  box-shadow: 0 12px 35px rgba(212, 175, 55, 0.6);
}

.discover-btn:active {
  transform: translateX(-50%) translateY(-1px);
}

.product {
  width: 100%;
  max-width: 220px;
  text-align: center;
  border: 1px solid #eee;
  padding: 15px;
  border-radius: 12px;
  background: #fff;
  position: relative;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  transition: transform 0.3s ease;
}

.product:hover {
  transform: translateY(-5px);
}

.product img {
  width: 100%;
  height: 250px;
  object-fit: cover;
  border-radius: 8px;
}

.product-details {
  margin-top: 15px;
  text-align: left;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.product-details p {
  font-size: 13px;
  color: #333;
  line-height: 1.4;
}

.product-details strong {
  color: #333;
}

.product-details div {
  font-size: 11px;
  color: #555;
  display: flex;
  justify-content: left;
  gap: 5px;
  line-height: 1.4;
}

.sale-price {
  color: red;
  font-weight: bold;
  display: inline-block;
  margin-right: 8px;
  font-size: 14px;
}

.regular-price {
  color: #767676;
  text-decoration: line-through;
  display: inline-block;
  font-size: 12px;
}

.product-image-container {
  position: relative;
}

.product-icons {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.icon-btn {
  background: rgba(255,255,255,0.9);
  border: none;
  border-radius: 50%;
  width: 35px;
  height: 35px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  transition: all 0.3s ease;
}

.icon-btn i {
  font-size: 16px;
}

.icon-btn.wishlist {
  color: #ff0000;
}

.icon-btn.wishlist:hover {
  background: #ff0000;
  color: #fff;
}

.icon-btn.cart {
  color: #007bff;
}

.icon-btn.cart:hover {
  background: #007bff;
  color: #fff;
}

.slider-container {
  position: relative;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 50px;
}

.slider-wrapper {
  overflow: hidden;
  border-radius: 12px;
}

.brand-grid, .category-grid {
  display: flex;
  gap: 20px;
  transition: transform 0.4s ease-in-out;
  padding: 20px 0;
}

.brand, .category {
  min-width: 160px;
  text-align: center;
  background: #fff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  flex-shrink: 0;
}

.brand:hover, .category:hover {
  transform: translateY(-8px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}

.brand img {
  width: 100px;
  height: 100px;
  object-fit: contain;
  border-radius: 50%;
  margin-bottom: 15px;
  border: 3px solid #f0f0f0;
}

.brand p {
  font-weight: bold;
  font-size: 0.95rem;
  color: #333;
  margin: 0;
  line-height: 1.3;
}

.category img {
  width: 100%;
  height: 150px;
  object-fit: cover;
  border-radius: 12px;
  margin-bottom: 15px;
  border: 2px solid #f0f0f0;
}

.category p {
  font-weight: bold;
  font-size: 0.95rem;
  color: #333;
  margin: 0;
  line-height: 1.3;
}

.slider-btn {
  background: linear-gradient(135deg,#7a7979,#8a8888);
  color: #fff;
  border: none;
  font-size: 18px;
  padding: 15px;
  cursor: pointer;
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  border-radius: 50%;
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(207,122,122,0.3);
  transition: all 0.3s ease;
  z-index: 10;
}

.slider-btn:hover {
  background: linear-gradient(135deg,#333535,#ef6e6e);
  transform: translateY(-50%) scale(1.1);
}

.slider-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
  box-shadow: none;
}

.slider-btn.left {
  left: 0;
}

.slider-btn.right {
  right: 0;
}

.view-all {
  display: inline-block;
  margin-top: 20px;
  color: #464643;
  font-weight: bold;
  text-decoration: none;
  padding: 12px 24px;
  border: 2px solid #191917;
  border-radius: 25px;
  transition: all 0.3s ease;
}

.view-all:hover {
  background: #2d280c;
  color: rgb(227,225,225);
}

.wishlist.active {
  color: #d45e37 !important;
  background-color: rgba(212, 95, 55, 0.1);
}

/* --- ADD THIS TO YOUR CSS --- */

/* 1. Wishlist Active State (When added) */
.icon-btn.wishlist.active {
    background-color: #fff0f0;
    border-color: #ff0000;
}
.icon-btn.wishlist.active i {
    color: #ff0000;
    font-weight: 900; /* Forces Solid Icon */
}

/* 2. Dark Mode Wishlist Active State */
body.dark-mode .icon-btn.wishlist.active {
  background: linear-gradient(135deg, rgba(212, 175, 55, 0.2), rgba(240, 217, 120, 0.2));
  border: 2px solid #d4af37;
  box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
}


/* 3. Dark Mode Toast Message (Golden Design) */
body.dark-mode .wishlist-toast {
    background-color: #1a1a1a !important; /* Dark BG */
    color: #d4af37 !important; /* Golden Text */
    border: 1px solid #d4af37; /* Golden Border */
    box-shadow: 0 0 20px rgba(212, 175, 55, 0.2) !important; /* Golden Glow */
}
/* Ensure Icons inside toast are also Gold in dark mode */
body.dark-mode .icon-btn.wishlist.active i {
  color: #d4af37;
  font-weight: 900;
  text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
}

/* 3. Dark Mode Toast Messages (Golden Design) */
body.dark-mode .wishlist-toast {
  background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%) !important;
  color: #d4af37 !important;
  border: 2px solid #d4af37 !important;
  box-shadow: 0 8px 32px rgba(212, 175, 55, 0.3), 
              0 0 20px rgba(212, 175, 55, 0.2) !important;
}

body.dark-mode .wishlist-toast i {
  color: #d4af37 !important;
  text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
}

body.dark-mode .wishlist-toast span {
  color: #f0d978 !important;
  font-weight: 600;
}

/* 4. Dark Mode Toast Variants */
body.dark-mode .wishlist-toast.success {
  background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%) !important;
  border-color: #d4af37 !important;
}

body.dark-mode .wishlist-toast.success i {
  color: #d4af37 !important;
}

body.dark-mode .wishlist-toast.error {
  background: linear-gradient(135deg, #2a1a1a 0%, #3a1a1a 100%) !important;
  border-color: #ff6b6b !important;
  box-shadow: 0 8px 32px rgba(255, 107, 107, 0.3), 
              0 0 20px rgba(255, 107, 107, 0.2) !important;
}

body.dark-mode .wishlist-toast.error i {
  color: #ff6b6b !important;
}

body.dark-mode .wishlist-toast.error span {
  color: #ffaaaa !important;
}

body.dark-mode .wishlist-toast.info {
  background: linear-gradient(135deg, #1a1a2a 0%, #1a2a3a 100%) !important;
  border-color: #66aaff !important;
  box-shadow: 0 8px 32px rgba(102, 170, 255, 0.3), 
              0 0 20px rgba(102, 170, 255, 0.2) !important;
}

body.dark-mode .wishlist-toast.info i {
  color: #66aaff !important;
}

body.dark-mode .wishlist-toast.info span {
  color: #99ccff !important;
}

/* 5. Dark Mode Cart Icon (Optional Enhancement) */
body.dark-mode .icon-btn.cart {
  background: rgba(102, 170, 255, 0.1);
  border: 1px solid rgba(102, 170, 255, 0.3);
  color: #66aaff;
}

body.dark-mode .icon-btn.cart:hover {
  background: rgba(102, 170, 255, 0.2);
  border-color: #66aaff;
  color: #99ccff;
  box-shadow: 0 0 15px rgba(102, 170, 255, 0.3);
}

/* 6. Pulse Animation for Active Wishlist in Dark Mode */
@keyframes goldenPulse {
  0% { box-shadow: 0 0 10px rgba(212, 175, 55, 0.2); }
  50% { box-shadow: 0 0 25px rgba(212, 175, 55, 0.5); }
  100% { box-shadow: 0 0 10px rgba(212, 175, 55, 0.2); }
}

body.dark-mode .icon-btn.wishlist.active {
  animation: goldenPulse 2s ease-in-out infinite;
}

@keyframes slideIn {
  from {
    transform: translateX(400px);
    opacity: 0;
  }
  to {
    transform: translateX(0);
    opacity: 1;
  }
}

@keyframes slideOut {
  from {
    transform: translateX(0);
    opacity: 1;
  }
  to {
    transform: translateX(400px);
    opacity: 0;
  }
}

.offer-badge {
  position: absolute;
  top: 10px;
  left: 10px;
  background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
  color: white;
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: bold;
  z-index: 10;
  box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
  transform: rotate(-5deg);
  animation: pulse 2s infinite;
}

/* ============================================
   BASE TOAST MESSAGE STYLING (LIGHT MODE)
   ============================================ */

.wishlist-toast {
  position: fixed;
  top: 20px;
  right: 20px;
  background: #27ae60;
  color: white;
  padding: 16px 24px;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  z-index: 10000;
  display: flex;
  align-items: center;
  gap: 12px;
  font-weight: 500;
  transform: translateX(400px);
  opacity: 0;
  transition: transform 0.3s ease-out, opacity 0.3s ease-out;
}

.wishlist-toast.show {
  transform: translateX(0);
  opacity: 1;
}

.wishlist-toast.error {
  background: #e74c3c;
}

.wishlist-toast.info {
  background: #3498db;
}

.wishlist-toast i {
  font-size: 18px;
}

@keyframes pulse {
  0% { transform: rotate(-5deg) scale(1); }
  50% { transform: rotate(-5deg) scale(1.05); }
  100% { transform: rotate(-5deg) scale(1); }
}

/* ============================================
   RESPONSIVE DESIGN - MOBILE FIRST
   ============================================ */

/* Mobile - Extra Small (320px - 480px) */
@media (max-width: 480px) {
  .banner {
    height: 300px;
  }

  .zodiac-banner {
    height: 300px;
  }

  .zodiac-symbol {
    font-size: 50px;
  }

  .zodiac-name {
    font-size: 28px;
    letter-spacing: 4px;
  }

  .zodiac-element {
    font-size: 11px;
  }

  .zodiac-description {
    font-size: 13px;
    line-height: 20px;
  }

  .zodiac-dates {
    font-size: 10px;
  }

  .zodiac-menu {
    left: 15px;
    font-size: 8px;
  }

  .zodiac-menu label {
    margin-bottom: 12px;
  }

  .banner-logo {
    font-size: 12px;
    top: 15px;
  }

  .banner-logo span {
    font-size: 10px;
  }

  .discover-btn {
    padding: 10px 25px;
    font-size: 11px;
    bottom: 15px;
  }

  .section {
    padding: 25px 15px;
  }

  .section h2 {
    font-size: 1.5rem;
    margin-bottom: 20px;
  }

  .product-grid {
    gap: 15px;
  }

  .product {
    max-width: 160px;
  }

  .product img {
    height: 180px;
  }

  .slider-container {
    padding: 0 30px;
  }

  .brand, .category {
    min-width: 130px;
    padding: 15px;
  }

  .brand img {
    width: 80px;
    height: 80px;
  }

  .category img {
    height: 120px;
  }

  .slider-btn {
    width: 40px;
    height: 40px;
    font-size: 16px;
  }
}

/* Mobile - Small (481px - 768px) */
@media (max-width: 768px) {
  .banner {
    height: 350px;
  }

  .zodiac-banner {
    height: 350px;
  }

  .zodiac-symbol {
    font-size: 60px;
  }

  .zodiac-name {
    font-size: 32px;
    letter-spacing: 6px;
  }

  .zodiac-element {
    font-size: 12px;
  }

  .zodiac-description {
    font-size: 14px;
    line-height: 22px;
  }

  .zodiac-dates {
    font-size: 11px;
  }

  .zodiac-menu {
    left: 20px;
    font-size: 9px;
  }

  .zodiac-menu label {
    margin-bottom: 15px;
  }

  .banner-logo {
    font-size: 13px;
    top: 20px;
  }

  .banner-logo span {
    font-size: 11px;
  }

  .discover-btn {
    padding: 12px 30px;
    font-size: 12px;
    bottom: 20px;
  }

  .section {
    padding: 30px 20px;
  }

  .section h2 {
    font-size: 1.75rem;
    margin-bottom: 25px;
  }

  .product-grid {
    gap: 20px;
  }

  .product {
    max-width: 180px;
  }

  .product img {
    height: 220px;
  }

  .slider-container {
    padding: 0 40px;
  }

  .brand, .category {
    min-width: 150px;
  }

  .slider-btn {
    width: 45px;
    height: 45px;
    font-size: 17px;
  }
}

/* Tablet (769px - 1024px) */
@media (min-width: 769px) and (max-width: 1024px) {
  .banner {
    height: 400px;
  }

  .zodiac-banner {
    height: 400px;
  }

  .slider-container {
    padding: 0 45px;
  }

  .product-grid {
    gap: 25px;
  }

  .product {
    max-width: 200px;
  }

  .product img {
    height: 270px;
  }
}

/* Desktop (1025px+) */
@media (min-width: 1025px) {
  .slider-container {
    padding: 0 60px;
  }

  .product-grid {
    gap: 30px;
  }

  .product {
    max-width: 230px;
  }

  .product img {
    height: 300px;
  }
}

/* ============================================
   DARK MODE — COMPLETE
   ============================================ */

body.dark-mode {
  background-color: #0e0e0e;
  color: #e0e0e0;
}

body.dark-mode .section {
  background-color: #0e0e0e;
}

body.dark-mode .section h2 {
  color: #ffd700;
}

body.dark-mode .product {
  background: #1a1a1a;
  border-color: #333;
  box-shadow: 0 2px 10px rgba(255,255,255,0.05);
}

body.dark-mode .product:hover {
  box-shadow: 0 4px 18px rgba(255,255,255,0.1);
}

body.dark-mode .product-details p,
body.dark-mode .product-details strong {
  color: #fff;
}

body.dark-mode .product-details div {
  color: #bbb;
}

body.dark-mode .sale-price {
  color: #ff9c6a;
}

body.dark-mode .regular-price {
  color: #888;
}

body.dark-mode .icon-btn.wishlist {
  background: rgba(212, 175, 55, 0.1);
  border: 1px solid rgba(212, 175, 55, 0.3);
  color: #d4af37;
}

body.dark-mode .icon-btn.wishlist:hover {
  background: rgba(212, 175, 55, 0.2);
  border-color: #d4af37;
  color: #f0d978;
  box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
}
body.dark-mode .icon-btn.cart {
  background: #222;
  color: #66aaff;
}

body.dark-mode .icon-btn.cart:hover {
  background: #66aaff;
  color: #fff;
}

body.dark-mode .brand {
  background: #1a1a1a;
  border-color: #333;
  box-shadow: 0 4px 12px rgba(255,255,255,0.08);
}

body.dark-mode .brand:hover {
  box-shadow: 0 8px 20px rgba(255,255,255,0.1);
}

body.dark-mode .brand p {
  color: #fff;
}

body.dark-mode .brand img {
  border-color: #555;
}

body.dark-mode .category {
  background: #1a1a1a;
  border-color: #333;
  box-shadow: 0 4px 12px rgba(255,255,255,0.08);
}

body.dark-mode .category:hover {
  box-shadow: 0 8px 20px rgba(255,255,255,0.1);
}

body.dark-mode .category p {
  color: #fff;
}

body.dark-mode .category img {
  border-color: #555;
}

body.dark-mode .slider-btn {
  background: linear-gradient(135deg, #333, #555);
  color: #fff;
  box-shadow: 0 4px 12px rgba(255,255,255,0.1);
}

body.dark-mode .slider-btn:hover {
  background: linear-gradient(135deg, #555, #777);
}

body.dark-mode .slider-btn:disabled {
  background: #333;
  box-shadow: 0 2px 6px rgba(255,255,255,0.05);
}

body.dark-mode .view-all {
  border-color: #fff;
  color: #fff;
}

body.dark-mode .view-all:hover {
  background: #fff;
  color: #000;
}

body.dark-mode .wishlist-toast {
  background: #222;
  color: #fff;
  box-shadow: 0 4px 12px rgba(0,0,0,0.5);
}

body.dark-mode .offer-badge {
  box-shadow: 0 2px 8px rgba(255, 107, 107, 0.5);
}

body.dark-mode .nav-logo img {
  filter: invert(1) !important;
}

body.dark-mode .brand img {
  filter: invert(1) !important;
}
</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<div class="banner">
  <div class="star-bg" id="starBg"></div>
  <h1 class="banner-logo">
    <span>Your Zodiac • Your Scent • Your Signature</span>
  </h1>
  <div class="zodiac-banner">
    <div class="zodiac-container">
      <input type="radio" name="zodiac" id="aries" checked>
      <input type="radio" name="zodiac" id="taurus">
      <input type="radio" name="zodiac" id="gemini">
      <input type="radio" name="zodiac" id="cancer">
      <input type="radio" name="zodiac" id="leo">
      <input type="radio" name="zodiac" id="virgo">
      <input type="radio" name="zodiac" id="libra">
      <input type="radio" name="zodiac" id="scorpio">
      <input type="radio" name="zodiac" id="sagittarius">
      <input type="radio" name="zodiac" id="capricorn">
      <input type="radio" name="zodiac" id="aquarius">
      <input type="radio" name="zodiac" id="pisces">
      <div class="zodiac-slide" style="--zodiac-color: #ff4444; --zodiac-glow: rgba(255, 68, 68, 0.6);"><div class="zodiac-content"><div class="zodiac-symbol">♈</div><div class="zodiac-element">Fire Sign</div><div class="zodiac-name">ARIES</div><div class="zodiac-description">Bold & Passionate<br>Fiery Confidence</div><div class="zodiac-dates">March 21 - April 19</div></div><div class="sparkle-container"><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div></div></div>
      <div class="zodiac-slide" style="--zodiac-color: #7cb342; --zodiac-glow: rgba(124, 179, 66, 0.6);"><div class="zodiac-content"><div class="zodiac-symbol">♉</div><div class="zodiac-element">Earth Sign</div><div class="zodiac-name">TAURUS</div><div class="zodiac-description">Sensual & Luxurious<br>Earthy Elegance</div><div class="zodiac-dates">April 20 - May 20</div></div><div class="sparkle-container"><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div></div></div>
      <div class="zodiac-slide" style="--zodiac-color: #ffd700; --zodiac-glow: rgba(255, 215, 0, 0.6);"><div class="zodiac-content"><div class="zodiac-symbol">♊</div><div class="zodiac-element">Air Sign</div><div class="zodiac-name">GEMINI</div><div class="zodiac-description">Vibrant & Dynamic<br>Dual Essence</div><div class="zodiac-dates">May 21 - June 20</div></div><div class="sparkle-container"><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div></div></div>
      <div class="zodiac-slide" style="--zodiac-color: #42a5f5; --zodiac-glow: rgba(66, 165, 245, 0.6);"><div class="zodiac-content"><div class="zodiac-symbol">♋</div><div class="zodiac-element">Water Sign</div><div class="zodiac-name">CANCER</div><div class="zodiac-description">Emotional & Nurturing<br>Moonlit Dream</div><div class="zodiac-dates">June 21 - July 22</div></div><div class="sparkle-container"><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div></div></div>
      <div class="zodiac-slide" style="--zodiac-color: #ff9800; --zodiac-glow: rgba(255, 152, 0, 0.6);"><div class="zodiac-content"><div class="zodiac-symbol">♌</div><div class="zodiac-element">Fire Sign</div><div class="zodiac-name">LEO</div><div class="zodiac-description">Radiant & Confident<br>Royal Majesty</div><div class="zodiac-dates">July 23 - August 22</div></div><div class="sparkle-container"><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div></div></div>
      <div class="zodiac-slide" style="--zodiac-color: #8bc34a; --zodiac-glow: rgba(139, 195, 74, 0.6);"><div class="zodiac-content"><div class="zodiac-symbol">♍</div><div class="zodiac-element">Earth Sign</div><div class="zodiac-name">VIRGO</div><div class="zodiac-description">Pure & Refined<br>Elegant Precision</div><div class="zodiac-dates">August 23 - September 22</div></div><div class="sparkle-container"><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div></div></div>
      <div class="zodiac-slide" style="--zodiac-color: #ec407a; --zodiac-glow: rgba(236, 64, 122, 0.6);"><div class="zodiac-content"><div class="zodiac-symbol">♎</div><div class="zodiac-element">Air Sign</div><div class="zodiac-name">LIBRA</div><div class="zodiac-description">Balanced & Harmonious<br>Graceful Beauty</div><div class="zodiac-dates">September 23 - October 22</div></div><div class="sparkle-container"><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div></div></div>
      <div class="zodiac-slide" style="--zodiac-color: #9c27b0; --zodiac-glow: rgba(156, 39, 176, 0.6);"><div class="zodiac-content"><div class="zodiac-symbol">♏</div><div class="zodiac-element">Water Sign</div><div class="zodiac-name">SCORPIO</div><div class="zodiac-description">Intense & Mysterious<br>Deep Passion</div><div class="zodiac-dates">October 23 - November 21</div></div><div class="sparkle-container"><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div></div></div>
      <div class="zodiac-slide" style="--zodiac-color: #ff6f00; --zodiac-glow: rgba(255, 111, 0, 0.6);"><div class="zodiac-content"><div class="zodiac-symbol">♐</div><div class="zodiac-element">Fire Sign</div><div class="zodiac-name">SAGITTARIUS</div><div class="zodiac-description">Adventurous & Free<br>Wild Spirit</div><div class="zodiac-dates">November 22 - December 21</div></div><div class="sparkle-container"><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div></div></div>
      <div class="zodiac-slide" style="--zodiac-color: #78909c; --zodiac-glow: rgba(120, 144, 156, 0.6);"><div class="zodiac-content"><div class="zodiac-symbol">♑</div><div class="zodiac-element">Earth Sign</div><div class="zodiac-name">CAPRICORN</div><div class="zodiac-description">Ambitious & Timeless<br>Classic Strength</div><div class="zodiac-dates">December 22 - January 19</div></div><div class="sparkle-container"><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div></div></div>
      <div class="zodiac-slide" style="--zodiac-color: #00bcd4; --zodiac-glow: rgba(0, 188, 212, 0.6);"><div class="zodiac-content"><div class="zodiac-symbol">♒</div><div class="zodiac-element">Air Sign</div><div class="zodiac-name">AQUARIUS</div><div class="zodiac-description">Innovative & Unique<br>Electric Energy</div><div class="zodiac-dates">January 20 - February 18</div></div><div class="sparkle-container"><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div></div></div>
      <div class="zodiac-slide" style="--zodiac-color: #7e57c2; --zodiac-glow: rgba(126, 87, 194, 0.6);"><div class="zodiac-content"><div class="zodiac-symbol">♓</div><div class="zodiac-element">Water Sign</div><div class="zodiac-name">PISCES</div><div class="zodiac-description">Dreamy & Intuitive<br>Mystical Waters</div><div class="zodiac-dates">February 19 - March 20</div></div><div class="sparkle-container"><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div><div class="sparkle"></div></div></div>
      <div class="zodiac-menu">
        <label for="aries">Aries</label>
        <label for="taurus">Taurus</label>
        <label for="gemini">Gemini</label>
        <label for="cancer">Cancer</label>
        <label for="leo">Leo</label>
        <label for="virgo">Virgo</label>
        <label for="libra">Libra</label>
        <label for="scorpio">Scorpio</label>
        <label for="sagittarius">Sagittarius</label>
        <label for="capricorn">Capricorn</label>
        <label for="aquarius">Aquarius</label>
        <label for="pisces">Pisces</label>
      </div>
    </div>
  </div>
  <a href="/zodiac" class="discover-btn">Discover Your Scent</a>
</div>

<div class="section">
  <h2>Today's Flash Sales</h2>
  <div class="product-grid">
    <% if (products && products.length > 0) { %>
      <% products.forEach(product => { %>
        <%
          let salePrice = 0, regularPrice = 0, discount = 0;
          if (product.variants && product.variants.length > 0) {
            const cheapestVariant = product.variants.reduce((minVar, currVar) => {
              const minP = minVar.salePrice || minVar.regularPrice || Infinity;
              const currP = currVar.salePrice || currVar.regularPrice || Infinity;
              return currP < minP ? currVar : minVar;
            }, { salePrice: Infinity, regularPrice: Infinity });
            salePrice = cheapestVariant.salePrice || cheapestVariant.regularPrice || 0;
            regularPrice = cheapestVariant.regularPrice || salePrice;
            if (regularPrice > salePrice) {
              discount = Math.round(((regularPrice - salePrice) / regularPrice) * 100);
            }
          } else {
            salePrice = product.salePrice || 0;
            regularPrice = product.regularPrice || 0;
            if (regularPrice > salePrice) {
              discount = Math.round(((regularPrice - salePrice) / regularPrice) * 100);
            }
          }
        %>
        <div class="product">
          <div class="product-image-container">
            <a href="/shopPage?id=<%= product._id %>">
              <img src="<%= product.images && product.images[0] ? product.images[0] : '/photos/default.png' %>" alt="<%= product.productName %>">
            </a>
            <div class="product-icons">
              <button class="icon-btn wishlist" onclick="addToWishlist('<%= product._id %>')">
                <i class="far fa-heart"></i>
              </button>
            </div>
            <% if (discount > 0) { %>
              <div class="offer-badge"><%= discount %>% OFF</div>
            <% } %>
          </div>
          <div class="product-details">
            <p><strong><%= product.productName %></strong></p>
            <div><strong>Brand:</strong> <%= product.brand ? product.brand.brandName : "No Brand" %></div>
            <div><strong>Category:</strong> <%= product.category ? product.category.name : "No Category" %></div>
            <p><span class="sale-price">₹<%= salePrice %></span><% if (discount > 0) { %><span class="regular-price">₹<%= regularPrice %></span><% } %></p>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <p>No products available</p>
    <% } %>
  </div>
  <a href="/shopPage" class="view-all">View All Products</a>
</div>

<div class="section">
  <h2>Popular Brands</h2>
  <div class="slider-container">
    <button class="slider-btn left" onclick="slideLeft('brandGrid')" id="brandLeftBtn">‹</button>
    <div class="slider-wrapper">
      <div class="brand-grid" id="brandGrid">
        <% if (brands && brands.length > 0) { %>
          <% brands.forEach(brand => { %>
            <a href="/shopPage?brands=<%= brand._id %>" class="brand">
              <img src="<%= brand.brandImage && brand.brandImage[0] ? brand.brandImage[0] : '/photos/default.png' %>" alt="<%= brand.brandName %> Logo">
              <p><%= brand.brandName %></p>
            </a>
          <% }) %>
        <% } else { %>
          <p>No brands available</p>
        <% } %>
      </div>
    </div>
    <button class="slider-btn right" onclick="slideRight('brandGrid')" id="brandRightBtn">›</button>
  </div>
</div>

<div class="section">
  <h2>Categories</h2>
  <div class="slider-container">
    <button class="slider-btn left" onclick="slideLeft('categoryGrid')" id="categoryLeftBtn">‹</button>
    <div class="slider-wrapper">
      <div class="category-grid" id="categoryGrid">
        <% if (categories && categories.length > 0) { %>
          <% categories.forEach(cat => { %>
            <a href="/shopPage?categorys=<%= cat._id %>" class="category">
              <img src="<%= cat.image ? cat.image : '/photos/default.png' %>" alt="<%= cat.name %>" class="category-img">
              <p><%= cat.name %></p>
            </a>
          <% }) %>
        <% } else { %>
          <p>No categories available</p>
        <% } %>
      </div>
    </div>
    <button class="slider-btn right" onclick="slideRight('categoryGrid')" id="categoryRightBtn">›</button>
  </div>
</div>

<div class="section">
  <h2>New Arrival</h2>
  <div class="product-grid">
    <% if (newArrivals && newArrivals.length > 0) { %>
      <% newArrivals.forEach(product => { %>
        <%
          let salePriceNew = 0, regularPriceNew = 0, discountNew = 0;
          if (product.variants && product.variants.length > 0) {
            const cheapestVariant = product.variants.reduce((minVar, currVar) => {
              const minP = minVar.salePrice || minVar.regularPrice || Infinity;
              const currP = currVar.salePrice || currVar.regularPrice || Infinity;
              return currP < minP ? currVar : minVar;
            }, { salePrice: Infinity, regularPrice: Infinity });
            salePriceNew = cheapestVariant.salePrice || cheapestVariant.regularPrice || 0;
            regularPriceNew = cheapestVariant.regularPrice || salePriceNew;
            if (regularPriceNew > salePriceNew) {
              discountNew = Math.round(((regularPriceNew - salePriceNew) / regularPriceNew) * 100);
            }
          } else {
            salePriceNew = product.salePrice || 0;
            regularPriceNew = product.regularPrice || 0;
            if (regularPriceNew > salePriceNew) {
              discountNew = Math.round(((regularPriceNew - salePriceNew) / regularPriceNew) * 100);
            }
          }
        %>
        <div class="product">
          <div class="product-image-container">
            <a href="/shopPage?id=<%= product._id %>">
              <img src="<%= product.images && product.images[0] ? product.images[0] : '/photos/default.png' %>" alt="<%= product.productName %>">
            </a>
            <div class="product-icons">
              <button class="icon-btn wishlist" onclick="addToWishlist('<%= product._id %>')">
                <i class="fas fa-heart"></i>
              </button>
            </div>
            <% if (discountNew > 0) { %>
              <div class="offer-badge"><%= discountNew %>% OFF</div>
            <% } %>
          </div>
          <div class="product-details">
            <p><strong><%= product.productName %></strong></p>
            <div><strong>Brand:</strong> <%= product.brand ? product.brand.brandName : "No Brand" %></div>
            <div><strong>Category:</strong> <%= product.category ? product.category.name : "No Category" %></div>
            <p><span class="sale-price">₹<%= salePriceNew %></span><% if (discountNew > 0) { %><span class="regular-price">₹<%= regularPriceNew %></span><% } %></p>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <p>No new arrivals available</p>
    <% } %>
  </div>
  <a href="/shopPage" class="view-all">View All Products</a>
</div>

<div class="section">
  <h2>Best Selling Products</h2>
  <div class="product-grid">
    <% if (bestSelling && bestSelling.length > 0) { %>
      <% bestSelling.forEach(product => { %>
        <%
          let salePriceBest = 0, regularPriceBest = 0, discountBest = 0;
          if (product.variants && product.variants.length > 0) {
            const cheapestVariant = product.variants.reduce((minVar, currVar) => {
              const minP = minVar.salePrice || minVar.regularPrice || Infinity;
              const currP = currVar.salePrice || currVar.regularPrice || Infinity;
              return currP < minP ? currVar : minVar;
            }, { salePrice: Infinity, regularPrice: Infinity });
            salePriceBest = cheapestVariant.salePrice || cheapestVariant.regularPrice || 0;
            regularPriceBest = cheapestVariant.regularPrice || salePriceBest;
            if (regularPriceBest > salePriceBest) {
              discountBest = Math.round(((regularPriceBest - salePriceBest) / regularPriceBest) * 100);
            }
          } else {
            salePriceBest = product.salePrice || 0;
            regularPriceBest = product.regularPrice || 0;
            if (regularPriceBest > salePriceBest) {
              discountBest = Math.round(((regularPriceBest - salePriceBest) / regularPriceBest) * 100);
            }
          }
        %>
        <div class="product">
          <div class="product-image-container">
            <a href="/shopPage?id=<%= product._id %>">
              <img src="<%= product.images && product.images[0] ? product.images[0] : '/photos/default.png' %>" alt="<%= product.productName %>">
            </a>
            <div class="product-icons">
              <button class="icon-btn wishlist" onclick="addToWishlist('<%= product._id %>')">
                <i class="fas fa-heart"></i>
              </button>
            </div>
            <% if (discountBest > 0) { %>
              <div class="offer-badge"><%= discountBest %>% OFF</div>
            <% } %>
          </div>
          <div class="product-details">
            <p><strong><%= product.productName %></strong></p>
            <div><strong>Brand:</strong> <%= product.brand ? product.brand.brandName : "No Brand" %></div>
            <div><strong>Category:</strong> <%= product.category ? product.category.name : "No Category" %></div>
            <p><span class="sale-price">₹<%= salePriceBest %></span><% if (discountBest > 0) { %><span class="regular-price">₹<%= regularPriceBest %></span><% } %></p>
          </div>
        </div>
      <% }) %>
    <% } else { %>
      <p>No best selling products available</p>
    <% } %>
  </div>
  <a href="/shopPage" class="view-all">View All Products</a>
</div>

<script>
  // --- 1. BACKGROUND STARS (Your Original Effect) ---
  const starBg = document.getElementById('starBg');
  if (starBg) {
    for (let i = 0; i < 80; i++) {
      const star = document.createElement('div');
      star.className = 'star';
      star.style.left = Math.random() * 100 + '%';
      star.style.top = Math.random() * 100 + '%';
      star.style.animationDelay = Math.random() * 3 + 's';
      starBg.appendChild(star);
    }
  }

  // --- 2. ZODIAC AUTO-ROTATION (Your Original Logic) ---
  const zodiacs = ['aries', 'taurus', 'gemini', 'cancer', 'leo', 'virgo', 'libra', 'scorpio', 'sagittarius', 'capricorn', 'aquarius', 'pisces'];
  let currentIndex = 0;
  let isTransitioning = false;

  function advanceZodiac() {
    if (isTransitioning) return;
    isTransitioning = true;
    currentIndex = (currentIndex + 1) % zodiacs.length;
    const zodiacElement = document.getElementById(zodiacs[currentIndex]);
    if (zodiacElement) {
      zodiacElement.checked = true;
    }
    setTimeout(() => {
      isTransitioning = false;
    }, 500);
  }

  setInterval(advanceZodiac, 4500);

  // --- 3. SLIDER LOGIC (Your Original Logic) ---
  class Slider {
    constructor(gridId) {
      this.grid = document.getElementById(gridId);
      this.leftBtn = document.getElementById(gridId.replace('Grid', 'LeftBtn'));
      this.rightBtn = document.getElementById(gridId.replace('Grid', 'RightBtn'));
      this.currentPosition = 0;
      this.itemWidth = 200;
      this.visibleItems = this.calculateVisibleItems();
      this.maxItems = this.grid.children.length;
      this.updateButtons();
      window.addEventListener('resize', () => {
        this.visibleItems = this.calculateVisibleItems();
        this.updateButtons();
      });
    }
    calculateVisibleItems() {
      return Math.floor(this.grid.parentElement.offsetWidth / this.itemWidth);
    }
    updateButtons() {
      if (this.leftBtn && this.rightBtn) {
        this.leftBtn.disabled = this.currentPosition <= 0;
        this.rightBtn.disabled = this.currentPosition >= this.maxItems - this.visibleItems;
      }
    }
    slideLeft() {
      if (this.currentPosition > 0) {
        this.currentPosition--;
        this.updateTransform();
      }
    }
    slideRight() {
      if (this.currentPosition < this.maxItems - this.visibleItems) {
        this.currentPosition++;
        this.updateTransform();
      }
    }
    updateTransform() {
      this.grid.style.transform = `translateX(-${this.currentPosition * this.itemWidth}px)`;
      this.updateButtons();
    }
  }

  const brandSlider = new Slider('brandGrid');
  const categorySlider = new Slider('categoryGrid');

  function slideLeft(gridId) {
    if (gridId === 'brandGrid') brandSlider.slideLeft();
    else if (gridId === 'categoryGrid') categorySlider.slideLeft();
  }

  function slideRight(gridId) {
    if (gridId === 'brandGrid') brandSlider.slideRight();
    else if (gridId === 'categoryGrid') categorySlider.slideRight();
  }

  function addSwipeSupport(slider) {
    let startX = 0,
      endX = 0;
    slider.grid.addEventListener('touchstart', e => {
      startX = e.touches[0].clientX;
    });
    slider.grid.addEventListener('touchmove', e => {
      endX = e.touches[0].clientX;
    });
    slider.grid.addEventListener('touchend', () => {
      const diff = startX - endX;
      if (Math.abs(diff) > 50) {
        if (diff > 0) slider.slideRight();
        else slider.slideLeft();
      }
    });
  }

  addSwipeSupport(brandSlider);
  addSwipeSupport(categorySlider);


  // --- 4. NEW MODERN TOAST FUNCTION ---
  function showToast(message, type = 'success') {
    const toast = document.createElement('div');
    toast.className = `wishlist-toast ${type}`;

    let icon = 'fa-check-circle';
    if (type === 'error') icon = 'fa-exclamation-circle';
    if (type === 'info') icon = 'fa-info-circle';

    toast.innerHTML = `<i class="fas ${icon}"></i><span>${message}</span>`;
    document.body.appendChild(toast);

    // Trigger Slide Animation
    requestAnimationFrame(() => {
      toast.classList.add('show');
    });

    // Remove after 3 seconds
    setTimeout(() => {
      toast.classList.remove('show');
      setTimeout(() => toast.remove(), 400);
    }, 3000);
  }

  // --- 5. UPDATED WISHLIST FUNCTION (With Icon Toggle) ---
  function addToWishlist(productId) {
    const clickedButton = event.currentTarget;
    // Find the icon inside the button
    const icon = clickedButton.querySelector('i');

    if (clickedButton.dataset.loading === 'true') return;
    clickedButton.dataset.loading = 'true';

    fetch('/wishlist/add', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          productId
        })
      })
      .then(res => res.json())
      .then(data => {
        clickedButton.dataset.loading = 'false';

        if (data.success) {
          // 1. Add Active Class (Red Color)
          clickedButton.classList.add('active');

          // 2. Switch to Solid Heart Icon
          if (icon) {
            icon.classList.remove('far'); // Remove outline
            icon.classList.add('fas'); // Add solid
          }

          // 3. Show Success Toast
          showToast('Added to Wishlist!', 'success');

        } else {
          // Even if it exists, ensure it looks active
          clickedButton.classList.add('active');
          if (icon) {
            icon.classList.remove('far');
            icon.classList.add('fas');
          }
          showToast(data.message || 'Already in your wishlist', 'info');
        }
      })
      .catch(err => {
        clickedButton.dataset.loading = 'false';
        console.error('Wishlist error:', err);
        showToast('Failed to add to wishlist', 'error');
      });
  }

  // --- 6. INITIAL LOAD (Check Wishlist Status) ---
  document.addEventListener('DOMContentLoaded', () => {
    fetch('/wishlist', {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(res => res.json())
      .then(data => {
        if (data.success && data.products && data.products.length > 0) {
          data.products.forEach(product => {
            const productId = product._id || product;
            // Find buttons for this product
            const buttons = document.querySelectorAll(`button.wishlist[onclick*="${productId}"]`);

            buttons.forEach(btn => {
              btn.classList.add('active');
              // Ensure icon is solid on load
              const icon = btn.querySelector('i');
              if (icon) {
                icon.classList.remove('far');
                icon.classList.add('fas');
              }
            });
          });
        }
      })
      .catch(err => console.error('Error loading wishlist:', err));
  });
</script>

<%- include("../partials/user/footer.ejs") %>