<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Users</title>

  <!-- Bootstrap for pagination styling -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/adminthings/dashboard.css">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
    }

    body {
      display: flex;
      min-height: 100vh;
      background-color: #f9f9f9;
    }

    .content {
      flex: 1;
      padding-left: 240px;
      padding-top: 100px;
      padding-right: 20px;
      width: 100%;
    }

    .content h1 {
      font-size: 28px;
      margin-bottom: 20px;
      padding-left: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }

    th, td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }

    th {
      background-color: #f1f1f1;
    }

    .btn-block {
      background-color: #e74c3c;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    .btn-unblock {
      background-color: #2ecc71;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }

    .pagination-container {
      margin-top: 30px;
      display: flex;
      justify-content: center;
    }

    @media (max-width: 768px) {
      .content {
        padding: 60px 10px;
      }

      .content h1 {
        font-size: 22px;
        padding-top: 20px;
      }

      table th, table td {
        font-size: 12px;
        padding: 8px;
      }
    }

    @media (max-width: 576px) {
      body {
        flex-direction: column;
      }

      .nav-links {
        flex-direction: row;
        flex-wrap: wrap;
        gap: 5px;
      }

      .btn-logout {
        margin-top: 10px;
      }
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<%- include("../partials/admin/header.ejs") %>

<body>
  <div class="content">
    <h1><strong>Users</strong></h1>
    
    <!-- User Table -->
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>FullName</th>     
          <th>Email</th>
          <th>Phone</th>
          <th>User Status</th>
        </tr>
      </thead>
      <tbody>
        <% users.forEach((user, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td><%= user.name %></td>
            <td><%= user.email %></td>
            <td><%= user.phone %></td>
          <td>
            <% if (!user.isBlocked) { %>
               <button type="button" class="btn-block swal-btn" data-url="/admin/blockCustomer?id=<%= user._id %>" data-action="block">Block User</button>
            <% } else { %>
              <button type="button" class="btn-unblock swal-btn" data-url="/admin/unblockCustomer?id=<%= user._id %>" data-action="unblock">Unblock User</button>
            <% } %>
          </td>


          </tr>
        <% }) %>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="pagination-container">
      <nav aria-label="Page navigation">
        <ul class="pagination">
          <% for (let i = 1; i <= totalPages; i++) { %>
            <li class="page-item <%= (i === currentPage) ? 'active' : '' %>">
              <a class="page-link" href="?page=<%= i %>"><%= i %></a>
            </li>
          <% } %>
        </ul>
      </nav>
    </div>
  </div>


<script>
  document.querySelectorAll('.swal-btn').forEach(button => {
    button.addEventListener('click', function () {
      const url = this.dataset.url;
      const action = this.dataset.action;

      Swal.fire({
        title: action === 'block' ? 'Are you sure?' : 'Unblock user?',
        text: action === 'block'
          ? "This user will be blocked!"
          : "This user will regain access.",
        icon: action === 'block' ? 'warning' : 'question',
        showCancelButton: true,
        confirmButtonColor: action === 'block' ? '#e74c3c' : '#2ecc71',
        cancelButtonColor: '#aaa',
        confirmButtonText: action === 'block' ? 'Yes, block!' : 'Yes, unblock!',
      }).then((result) => {
        if (result.isConfirmed) {
          // Create and submit form manually
          const form = document.createElement('form');
          form.method = 'POST';
          form.action = url;
          document.body.appendChild(form);
          form.submit();
        }
      });
    });
  });
</script>


</body>
</html>
