<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  :root {
    --primary: #4f46e5;
    --primary-hover: #4338ca;
    --success: #10b981;
    --danger: #ef4444;
    --warning: #f59e0b;
    --bg-main: #f8fafc;
    --card-bg: #ffffff;
    --text-main: #1e293b;
    --text-muted: #64748b;
    --border-color: #e2e8f0;
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-main);
    color: var(--text-main);
    -webkit-font-smoothing: antialiased;
  }

  .main-content {
    margin-left: 260px; /* Adjusted for standard sidebars */
    padding: 2rem;
    transition: all 0.3s ease;
  }

  /* Header Section */
  .page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
  }

  .header-title h2 {
    font-size: 1.75rem;
    font-weight: 700;
    letter-spacing: -0.025em;
  }

  .header-title p {
    color: var(--text-muted);
    font-size: 0.875rem;
  }

  /* Modern Stats Grid */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 1rem;
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-sm);
    transition: transform 0.2s, box-shadow 0.2s;
    cursor: pointer;
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .stat-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
  }

  /* Action Bar */
  .toolbar {
    background: var(--card-bg);
    padding: 1.25rem;
    border-radius: 1rem;
    border: 1px solid var(--border-color);
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
    box-shadow: var(--shadow-sm);
  }

  .search-wrapper {
    position: relative;
    flex: 1;
    max-width: 400px;
  }

  .search-form {
    display: flex;
    background: #f1f5f9;
    border-radius: 0.75rem;
    padding: 2px;
    border: 1px solid transparent;
    transition: all 0.2s;
  }

  .search-form:focus-within {
    background: white;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
  }

  .search-input {
    background: transparent;
    border: none;
    padding: 0.6rem 1rem;
    width: 100%;
    outline: none;
    font-size: 0.9rem;
  }

  .search-btn {
    background: var(--primary);
    color: white;
    border: none;
    padding: 0.5rem 1.25rem;
    border-radius: 0.6rem;
    font-weight: 500;
    cursor: pointer;
    transition: background 0.2s;
  }

  /* Table Styling */
  .table-card {
    background: var(--card-bg);
    border-radius: 1rem;
    border: 1px solid var(--border-color);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
  }

  .brand-table {
    width: 100%;
    border-collapse: collapse;
    text-align: left;
  }

  .brand-table th {
    background: #f8fafc;
    padding: 1rem 1.5rem;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--text-muted);
    border-bottom: 1px solid var(--border-color);
  }

  .brand-table td {
    padding: 1rem 1.5rem;
    border-bottom: 1px solid var(--border-color);
    vertical-align: middle;
  }

  .brand-info {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .brand-logo {
    width: 50px;
    height: 50px;
    object-fit: contain;
    background: #fff;
    border-radius: 8px;
    border: 1px solid var(--border-color);
    padding: 4px;
  }

  .brand-name {
    font-weight: 600;
    font-size: 0.95rem;
  }

  /* Badges & Buttons */
  .badge {
    padding: 0.35rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .badge-success { background: #dcfce7; color: #166534; }
  .badge-danger { background: #fee2e2; color: #991b1b; }

  .btn-primary {
    background: var(--primary);
    color: white;
    padding: 0.6rem 1.2rem;
    border-radius: 0.75rem;
    border: none;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-primary:hover { background: var(--primary-hover); }

  .action-btn {
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-size: 0.85rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.2s;
  }

  .btn-outline-danger {
    border: 1px solid var(--danger);
    color: var(--danger);
  }

  .btn-outline-danger:hover {
    background: var(--danger);
    color: white;
  }

  .btn-outline-success {
    border: 1px solid var(--success);
    color: var(--success);
  }

  .btn-outline-success:hover {
    background: var(--success);
    color: white;
  }

  /* Filter Pills */
  .filter-group {
    display: flex;
    gap: 0.5rem;
    background: #f1f5f9;
    padding: 0.25rem;
    border-radius: 0.75rem;
  }

  .filter-pill {
    padding: 0.5rem 1rem;
    border-radius: 0.6rem;
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text-muted);
    text-decoration: none;
    transition: all 0.2s;
  }

  .filter-pill.active {
    background: white;
    color: var(--primary);
    box-shadow: var(--shadow-sm);
  }

  /* Responsive Adjustments */
  @media (max-width: 1024px) {
    .main-content { margin-left: 0; padding: 1.5rem; }
    .page-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
  }

  @media (max-width: 768px) {
    .toolbar { flex-direction: column; align-items: stretch; }
    .search-wrapper { max-width: 100%; }
    .brand-table thead { display: none; }
    .brand-table tr { 
        display: block; 
        border: 1px solid var(--border-color); 
        margin-bottom: 1rem; 
        border-radius: 0.75rem;
    }
    .brand-table td { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        padding: 0.75rem 1rem;
        text-align: right;
    }
    .brand-table td::before {
        content: attr(data-label);
        font-weight: 600;
        color: var(--text-muted);
        text-align: left;
    }
  }
</style>

<body>

<%- include("../partials/admin/header.ejs") %>

<div class="main-content">
  <div class="page-header">
    <div class="header-title">
      <h2>Brand Management</h2>
      <p>Manage and organize your product brands</p>
    </div>
    <button class="btn-primary" onclick="window.location.href='/admin/addbrand'">
      <i class="fas fa-plus"></i> Add New Brand
    </button>
  </div>

  <div class="stats-grid">
    <div class="stat-card" onclick="window.location.href='/admin/brands'">
      <div style="display: flex; justify-content: space-between;">
        <div>
          <p style="color: var(--text-muted); font-size: 0.75rem; font-weight: 700; text-transform: uppercase;">Total Brands</p>
          <h3 style="font-size: 1.8rem; margin-top: 0.5rem;"><%= totalBrands || data.length %></h3>
        </div>
        <div class="stat-icon" style="background: rgba(79, 70, 229, 0.1); color: var(--primary);">
          <i class="fas fa-boxes"></i>
        </div>
      </div>
    </div>

    <div class="stat-card" onclick="window.location.href='/admin/brands?status=listed'">
      <div style="display: flex; justify-content: space-between;">
        <div>
          <p style="color: var(--text-muted); font-size: 0.75rem; font-weight: 700; text-transform: uppercase;">Listed</p>
          <h3 style="font-size: 1.8rem; margin-top: 0.5rem; color: var(--success);"><%= listedBrands || data.filter(b => !b.isBlocked).length %></h3>
        </div>
        <div class="stat-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success);">
          <i class="fas fa-check-circle"></i>
        </div>
      </div>
    </div>

    <div class="stat-card" onclick="window.location.href='/admin/brands?status=unlisted'">
      <div style="display: flex; justify-content: space-between;">
        <div>
          <p style="color: var(--text-muted); font-size: 0.75rem; font-weight: 700; text-transform: uppercase;">Unlisted</p>
          <h3 style="font-size: 1.8rem; margin-top: 0.5rem; color: var(--danger);"><%= unlistedBrands || data.filter(b => b.isBlocked).length %></h3>
        </div>
        <div class="stat-icon" style="background: rgba(239, 68, 68, 0.1); color: var(--danger);">
          <i class="fas fa-times-circle"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="toolbar">
    <div class="filter-group">
      <a href="/admin/brands" class="filter-pill <%= (!status || status === '') ? 'active' : '' %>">All</a>
      <a href="/admin/brands?status=listed" class="filter-pill <%= status === 'listed' ? 'active' : '' %>">Listed</a>
      <a href="/admin/brands?status=unlisted" class="filter-pill <%= status === 'unlisted' ? 'active' : '' %>">Unlisted</a>
    </div>

    <div class="search-wrapper">
      <form action="/admin/brands" method="GET" class="search-form" id="searchForm">
        <input 
          type="text" 
          name="search" 
          placeholder="Search brands..." 
          value="<%= search || '' %>"
          id="searchInput"
          class="search-input"
        />
        <% if (search && search.trim() !== '') { %>
          <button type="button" class="cancel-search-btn" onclick="clearSearch(event)" style="background:none; border:none; padding: 0 10px; color: var(--text-muted); cursor:pointer;">
            <i class="fas fa-times"></i>
          </button>
        <% } %>
        <button type="submit" class="search-btn">Search</button>
      </form>
    </div>
  </div>

  <div class="table-card">
    <table class="brand-table">
      <thead>
        <tr>
          <th>Brand Details</th>
          <th>Status</th>
          <th style="text-align: right;">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% if (data && data.length > 0) { %>
          <% data.forEach(brand => { %>
            <tr>
              <td data-label="Brand Details">
                <div class="brand-info">
                  <img src="<%= brand.brandImage[0] %>" alt="" class="brand-logo" />
                  <span class="brand-name"><%= brand.brandName %></span>
                </div>
              </td>
              <td data-label="Status">
                <% if (brand.isBlocked) { %>
                  <span class="badge badge-danger">Unlisted</span>
                <% } else { %>
                  <span class="badge badge-success">Listed</span>
                <% } %>
              </td>
              <td data-label="Actions" style="text-align: right;">
                <% if (!brand.isBlocked) { %>
                  <a href="/admin/blockBrand?id=<%= brand._id %>" class="action-btn btn-outline-danger confirm-action" data-action="unlist">
                    <i class="fas fa-ban"></i> Unlist
                  </a>
                <% } else { %>
                  <a href="/admin/unblockBrand?id=<%= brand._id %>" class="action-btn btn-outline-success confirm-action" data-action="list">
                    <i class="fas fa-check"></i> List
                  </a>
                <% } %>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="3" style="text-align: center; padding: 4rem;">
              <i class="fas fa-folder-open" style="font-size: 3rem; color: var(--border-color); margin-bottom: 1rem; display: block;"></i>
              <h3 style="color: var(--text-muted);">No brands found</h3>
              <p style="color: var(--text-muted); font-size: 0.9rem;">Try adjusting your filters or search terms.</p>
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>

  <% if (totalPages > 1) { %>
    <div style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 2rem;">
      <% if(currentPage > 1) { %>
        <a href="?search=<%= search %>&page=<%= currentPage - 1 %>" class="filter-pill active">Prev</a>
      <% } %>
      
      <% for(let i = 1; i <= totalPages; i++) { %>
        <a href="?search=<%= search %>&page=<%= i %>" class="filter-pill <%= i === currentPage ? 'active' : '' %>"><%= i %></a>
      <% } %>

      <% if(currentPage < totalPages) { %>
        <a href="?search=<%= search %>&page=<%= currentPage + 1 %>" class="filter-pill active">Next</a>
      <% } %>
    </div>
  <% } %>
</div>

<script>
  function clearSearch(event) {
    event.preventDefault();
    document.getElementById('searchInput').value = '';
    window.location.href = '/admin/brands';
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.querySelector("tbody").addEventListener("click", function(e) {
      const target = e.target.closest(".confirm-action");
      if(target) {
        e.preventDefault();
        const url = target.getAttribute("href");
        const action = target.dataset.action;
        
        Swal.fire({
          title: `Are you sure?`,
          text: `You are about to ${action} this brand.`,
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: action === 'list' ? "#10b981" : "#ef4444",
          cancelButtonColor: "#64748b",
          confirmButtonText: `Yes, ${action} it!`,
          background: '#ffffff',
          borderRadius: '1rem'
        }).then(result => { 
          if(result.isConfirmed) {
            window.location.href = url;
          }
        });
      }
    });
  });
</script>

</body>