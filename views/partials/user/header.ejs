<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* =========================================
   1. THEME ENGINE (CSS Variables)
   ========================================= */
:root {
    /* --- Light Mode (Default) --- */
    --bg-body: #ffffff;
    --bg-nav: #ffffff;
    --bg-dropdown: #ffffff;
    --bg-topbar: #000000;
    
    --text-main: #000000;
    --text-topbar: #ffffff;
    --text-muted: #555555;
    
    --border-color: #e5e5e5;
    --icon-color: #000000;
    --hover-color: #f3f4f6;
    
    /* Logo: Default (Black) */
    --logo-filter: none;
    
    --shadow: 0 4px 15px rgba(0,0,0,0.1);
}

body.dark-mode {
    /* --- Dark Mode (Overrides) --- */
    --bg-body: #121212;        
    --bg-nav: #1a1a1a;        
    --bg-dropdown: #252525;
    --bg-topbar: #252525;
    
    --text-main: #ffffff;
    --text-topbar: #e0e0e0;
    --text-muted: #a0a0a0;
    
    --border-color: #333333;
    --icon-color: #ffffff;
    --hover-color: #333333;
    
    --logo-filter: brightness(0) invert(1);
    
    --shadow: 0 4px 15px rgba(0,0,0,0.6);
}

/* =========================================
   2. GLOBAL STYLES
   ========================================= */
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    background-color: var(--bg-body) !important;
    color: var(--text-main) !important;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    transition: background-color 0.3s ease, color 0.3s ease;
    min-height: 100vh;
}

a { text-decoration: none; color: var(--text-main); transition: 0.3s; }

/* --- Top Bar --- */
.top-bar {
    background-color: var(--bg-topbar);
    color: var(--text-topbar);
    font-size: 13px;
    text-align: center;
    padding: 8px 0;
    letter-spacing: 0.5px;
}
.top-bar a { color: inherit; text-decoration: underline; }

/* --- Navbar --- */
.navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 7px 40px;
    background-color: var(--bg-nav);
    border-bottom: 1px solid var(--border-color);
    position: sticky;
    top: 0;
    z-index: 1000;
    transition: background-color 0.3s ease;
}

.nav-logo img { 
    width: 120px; 
    height: auto;
    filter: var(--logo-filter);
    transition: filter 0.3s ease;
}

/* Nav Links */
nav.nav-links { display: flex; gap: 25px; align-items: center; }
nav.nav-links a {
    color: var(--text-main);
    font-size: 15px;
    font-weight: 500;
}
nav.nav-links a:hover, nav.nav-links a.active { 
    font-weight: bold; 
    text-decoration: underline; 
}

/* Icons Area */
.nav-icons { display: flex; align-items: center; gap: 20px; }

.nav-icons a, .theme-toggle-btn, .user-icon-btn {
    color: var(--icon-color);
    font-size: 20px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform 0.2s;
    background: none;
    border: none;
    cursor: pointer;
}
.nav-icons a:hover, .theme-toggle-btn:hover, .user-icon-btn:hover { transform: scale(1.1); }

/* Notification Badge */
.notification-badge {
    position: absolute; top: -6px; right: -8px;
    background: #ef4444; color: white;
    border-radius: 50%; width: 16px; height: 16px;
    font-size: 10px; display: flex;
    align-items: center; justify-content: center;
    border: 2px solid var(--bg-nav);
    font-weight: bold;
}
.hide { display: none; }
.show { display: flex; }

/* =========================================
   3. DROPDOWN FIX (CLICK BASED)
   ========================================= */
.dropdown { position: relative; }

.dropdown-content {
    display: none; /* Hidden by default */
    position: absolute; 
    right: 0; 
    top: 130%; /* Pushes it slightly down */
    background-color: var(--bg-dropdown);
    min-width: 180px;
    box-shadow: var(--shadow);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    overflow: hidden;
    z-index: 2000;
    flex-direction: column;
}

/* Use JS class 'active' to show, not :hover */
.dropdown-content.active {
    display: flex;
    animation: fadeIn 0.2s ease-in-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Dropdown Links */
.dropdown-content a {
    display: block; 
    padding: 12px 16px;
    color: var(--text-main) !important; /* Forces correct color in Dark Mode */
    font-size: 14px;
    border-bottom: 1px solid var(--border-color);
    text-align: left;
    white-space: nowrap;
}

.dropdown-content a:last-child { border-bottom: none; }
.dropdown-content a:hover { background-color: var(--hover-color); }

.user-name-box {
    padding: 12px 16px; 
    font-weight: bold; 
    color: var(--text-main); 
    border-bottom: 1px solid var(--border-color);
    background-color: var(--hover-color);
    font-size: 14px;
}

/* --- Mobile Menu --- */
.hamburger { display: none; font-size: 22px; color: var(--icon-color); cursor: pointer; }

.mobile-nav {
    display: none; flex-direction: column;
    background-color: var(--bg-nav);
    position: absolute; top: 100%; left: 0; width: 100%;
    border-top: 1px solid var(--border-color);
    box-shadow: var(--shadow);
    padding: 15px 20px; gap: 15px;
}
.mobile-nav a { color: var(--text-main); font-size: 14px; }

@media screen and (max-width: 768px) {
    .navbar { padding: 15px 20px; }
    nav.nav-links { display: none; }
    .hamburger { display: block; }
}


@media screen and (max-width: 768px) {

    .navbar {
        display: grid;
        grid-template-columns: auto 1fr auto;
        align-items: center;
        padding: 12px 16px;
    }

    /* Hamburger LEFT */
    .hamburger {
        display: flex;
        justify-content: flex-start;
        font-size: 22px;
    }

    /* Logo CENTER */
    .nav-logo {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .nav-logo img {
        width: 105px;
    }

    /* Icons RIGHT */
    .nav-icons {
        display: flex;
        justify-content: flex-end;
        gap: 16px;
    }

    /* Hide desktop nav links */
    nav.nav-links {
        display: none;
    }

    /* Mobile nav dropdown */
    .mobile-nav {
        position: absolute;
        top: 100%;
        left: 0;
        width: 100%;
        z-index: 999;
    }
}

@media screen and (max-width: 768px) {

    .mobile-nav {
        text-align: center;
    }

    .mobile-nav a {
        padding: 14px 0;
        font-size: 15px;
        font-weight: 500;
    }

    .mobile-nav a:hover {
        background-color: var(--hover-color);
        border-radius: 6px;
    }
}


</style>



<header class="navbar">

        <div class="hamburger" id="hamburger">
        <i class="fa fa-bars"></i>
    </div>

    <div class="nav-logo">
        <a href="/home"><img src="/photos/zodiac perfume/brand logo.png" alt="Sentique Logo"></a>
    </div>



    <nav class="nav-links" id="navLinks">
        <a href="/home">Home</a>
        <a href="/shopPage">Shop</a>
        <a href="/contact">Contact</a>
        <a href="/">About</a>
    </nav>

    <div class="nav-icons">
        
        <button id="themeToggle" class="theme-toggle-btn">
            <i id="themeIcon" class="fas fa-moon"></i>
        </button>

        <a href="/wishlist" title="Wishlist" id="wishlistLink">
            <i class="fa fa-heart"></i>
            <span class="notification-badge hide" id="wishlistBadge">0</span>
        </a>

        <a href="/cart" title="Cart" id="cartLink">
            <i class="fa fa-shopping-cart"></i>
            <span class="notification-badge hide" id="cartBadge">0</span>
        </a>

        <% if (user) { %>
        <div class="dropdown">
            <button class="user-icon-btn" id="userIconBtn">
                <i class="fa fa-user-circle"></i>
            </button>
            
            <div class="dropdown-content" id="userDropdown">
                <div class="user-name-box">
                    Hello, <%= user.name %>
                </div>
                <a href="/profile">My Profile</a>
                <a href="/profile/order-list">My Orders</a>
                <a href="/logout" style="color: #ef4444 !important;">Logout</a>
            </div>
        </div>
        <% } else { %>
            <a href="/login" style="font-size: 14px; font-weight: 600;">Login</a>
            <a href="/signup" style="font-size: 14px; font-weight: 600;">Sign Up</a>
        <% } %>

    </div>

    <nav class="mobile-nav" id="mobileNav">
        <a href="/home">Home</a>
        <a href="/shopPage">Shop</a>
        <a href="/contact">Contact</a>
        <a href="/">About</a>
        
        <hr style="border: 0; border-top: 1px solid var(--border-color);">

        <% if (!user) { %>
            <a href="/login">Login</a>
            <a href="/signup">Sign Up</a>
        <% } else { %>
            <a href="/profile">My Profile</a>
            <a href="/profile/order-list">My Orders</a>
            <a href="/logout" style="color: #ef4444;">Logout</a>
        <% } %>
    </nav>

</header>

<script>
// Hamburger Menu Toggle
const hamburger = document.getElementById("hamburger");
const mobileNav = document.getElementById("mobileNav");
if(hamburger){
    hamburger.addEventListener("click", () => {
        mobileNav.style.display = mobileNav.style.display === "flex" ? "none" : "flex";
    });
}

// ================= DROPDOWN FIX (CLICK) =================
const userIconBtn = document.getElementById('userIconBtn');
const userDropdown = document.getElementById('userDropdown');

if (userIconBtn && userDropdown) {
    // Toggle on click
    userIconBtn.addEventListener('click', (e) => {
        e.stopPropagation(); // Prevent immediate closing
        userDropdown.classList.toggle('active');
    });

    // Close when clicking anywhere else
    document.addEventListener('click', (e) => {
        if (!userDropdown.contains(e.target) && !userIconBtn.contains(e.target)) {
            userDropdown.classList.remove('active');
        }
    });
}

/* ================= DARK MODE LOGIC ================= */
const toggleBtn = document.getElementById("themeToggle");
const themeIcon = document.getElementById("themeIcon");
const body = document.body;

// 1. Load Theme from LocalStorage
const savedTheme = localStorage.getItem("sentique-theme");
if (savedTheme === "dark") {
    body.classList.add("dark-mode");
    themeIcon.className = "fa fa-sun";
}

// 2. Toggle Theme
if(toggleBtn){
    toggleBtn.addEventListener("click", () => {
        const dark = body.classList.toggle("dark-mode");

        if (dark) {
            themeIcon.className = "fa fa-sun";
            localStorage.setItem("sentique-theme", "dark");
        } else {
            themeIcon.className = "fa fa-moon";
            localStorage.setItem("sentique-theme", "light");
        }
    });
}

/* ================= BADGES LOGIC ================= */
function updateBadges() {
    const fetchAndUpdate = (url, elementId) => {
        fetch(url)
            .then(res => res.json())
            .then(data => {
                const el = document.getElementById(elementId);
                if (el && data.count > 0) {
                    el.textContent = data.count > 9 ? '9+' : data.count;
                    el.classList.remove('hide');
                    el.classList.add('show');
                } else if (el) {
                    el.classList.remove('show');
                    el.classList.add('hide');
                }
            })
            .catch(err => console.log('Badge fetch error:', err));
    };

    fetchAndUpdate('/cart/count', 'cartBadge');
    fetchAndUpdate('/wishlist/count', 'wishlistBadge');
}

document.addEventListener("DOMContentLoaded", updateBadges);
</script>